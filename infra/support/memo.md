## sec 1

- word
  - Netfilter
    - カーネルにおいて、ネットワークパケットを操作するフレームワーク
  - VIP
    - 物理サーバや　NIC ではなく、不動的にサービスや役割に割り当てられる IP アドレスのこと
  - スイッチングハブ
    - ブリッジ機能を有する
    - L2 スイッチ、単にスイッチとも
  - ネットワークセグメント
    - ブロードキャストパケットが届く範囲のネットワークのこと
- ヘルスチェック
  - ICMP 監視
    - L3
    - ICMP の echo リクエスト
    - できる
      - ルータ障害によるサービス停止
    - 無理
      - サービスがダウンした場合の検知
  - ポート監視
    - L4
    - できる
      - サービスがダウンしたこと
    - 無理
      - 過負荷状態で応答できない
      - エラーを返している
  - サービス監視
    - L7
    - ほとんどの異常を検知する
    - 場合によってはサービスに負荷をかけてしまう
- LAN (Ethernet) の世界では IP アドレスではなく NIC に固定で割り当てられている MAC アドレスを使う
  - ARP, IP -> MAC
- DNS ラウンドロビン
- L4, L7
  - L4 はパケットをそのまま転送
    - NAT or DSR
  - L7 は L7 スイッチを境に2本の TCP コネクションが貼られる
- VRRP
  - VRRP パケットをマルチキャストアドレスに放出
    -  advertisement
 - priority
 - 仮想 MAC アドレス

## sec 2

- リバースプロキシ
  - WAN -> LAN の要求を代理する
  - AP サーバのバッファとしての機能
    - HTTP の Keep-Alive
      - メモリ消費と Keep-Alive のトレードオフ
- MySQL のレプリケーション
- ストレージサーバ
  - スケールさせにくい
    - 単一障害点になりやすい
    - ボトルネックになりやすい

## sec 3

- DNS 障害は影響が大きい
- ネットワークの冗長性: L1, L2
  - LAN
  - NIC
  - スイッチのポート
  - スイッチ
- RSTP: Rapid Spanning Tree Protocol
  - 各スイッチが協調してネットワーク上にできたループの検出
- VLAN
  - Static VLAN
  - Dynamic VLAN

## sec 4

- 負荷分散
  - 多くの場合、ディスク I/O の分散と軽減
    - OS は I/O を軽減するためのキャッシュ機能を備えている
    - キャッシュが最も有効に働くように設計する！
- ボトルネック見極め
  - ロードアベレージを見る
    - top, uptime
  - CPU, I/O の何がボトルネックかをさぐる
    - sar, vmstat
- マルチタスクと OS 負荷
  - **プロセススケジューラ**
  - タイマ割り込み
- sar: System Activity Reporter
- **負荷を知るとは、カーネルの動作を知るということ**
  - **何をどのような順番で見ていくかは、カーネルの内部動作がわかっていれば自明**
- time
  - CPU 使用時間
  - **≠ プロセスが生成されてからの経過時間**
  - プロセスディスクリプタに記録された CPU 使用時間のこと

## sec 5

- Apache
  - `mod_status`
    - http://192.168.0.113/server-status
- デーモンの稼働監視
  - daemontools とか
- ログの集約
  - syslog が手軽
    - logger, 標準入力から受け取ったログを syslog に渡せる
- ログの収集
  - 保存と解析
